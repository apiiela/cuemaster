<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cuepoints — Full App</title>
  <style>
    :root{--bg:#0b0c10;--panel:#0f1117;--muted:#9aa3af;--text:#e6e8eb;--accent:#5b8cff;--ok:#22c55e}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Arial;color:var(--text);background:linear-gradient(180deg,#07070a,#0b0c10)}
    .app{max-width:1100px;margin:28px auto;padding:20px}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:14px}
    h1{margin:0;font-size:1.2rem}
    .lead{margin:6px 0 0;color:var(--muted)}
    .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.03));border:1px solid rgba(255,255,255,0.03);padding:14px;border-radius:12px}
    .controls{display:flex;gap:8px;align-items:center;margin-bottom:12px;flex-wrap:wrap}
    button{background:transparent;border:1px solid #222;padding:8px 10px;border-radius:8px;color:var(--text);cursor:pointer}
    button.primary{background:var(--accent);border:none;color:#051025}
    input[type=file]{display:none}
    .drop{border:2px dashed rgba(255,255,255,0.03);padding:18px;border-radius:10px;text-align:center;color:var(--muted);margin-bottom:12px}
    canvas{width:100%;height:140px;border-radius:8px;background:#051019;display:block;cursor:pointer}
    .time{font-variant-numeric:tabular-nums;color:var(--muted);min-width:110px;text-align:center;padding:6px;border-radius:8px;font-size:1.5rem;font-weight:bold}
    .cue-list{margin-top:12px;border-radius:10px;overflow:auto}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px 10px;text-align:left;border-bottom:1px solid rgba(255,255,255,0.02)}
    .swatch{width:18px;height:18px;border-radius:4px;display:inline-block;margin-right:8px;vertical-align:middle}
    .small{font-size:.9rem;color:var(--muted)}
    .kbd{border:1px solid rgba(255,255,255,0.06);padding:4px 6px;border-radius:6px;background:rgba(255,255,255,0.01)}
    .muted{color:var(--muted)}
    @media (max-width:800px){.cols{flex-direction:column}}
    .cols{display:flex;gap:12px}
    .col{flex:1}
    .notes{width:100%;min-width:120px}
    .flash{color:var(--ok)}
    .cue-banner{position:absolute;background:#111;padding:4px 8px;border-radius:6px;font-size:0.8rem;white-space:nowrap;transform:translateY(-100%);pointer-events:none}
    .playlist{margin:12px 0;display:flex;gap:6px;flex-wrap:wrap}
    .page-btn{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:6px;border:1px solid #333;cursor:pointer;position:relative}
    .page-label{flex:1;}
    .rename-input{position:absolute;top:0;left:0;width:100%;height:100%;border:none;border-radius:6px;padding:4px;text-align:center;font-size:0.9rem;z-index:2}
    .remove-btn{background:transparent;border:none;color:#eee;cursor:pointer;font-size:0.8rem;padding:0 4px}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div>
        <h1>Cuepoints — Full App</h1>
        <div class="lead">Import audio, add/edit cue points, save/load sessions. Timecode flashes green when a cue triggers.</div>
      </div>
      <div style="text-align:right">
        <div class="small">Shortcuts: <span class="kbd">Space</span>=Play, <span class="kbd">C</span>=Add cue, <span class="kbd">←/→</span>=Seek 5s, <span class="kbd">[</span>/<span class="kbd">]</span>=Frame step</div>
      </div>
    </header>

    <div class="playlist" id="playlist"></div>
    <button id="newPageBtn">＋ New Page</button>

    <div class="panel">
      <div class="drop" id="dropZone">Drop audio file here or click to select<input type="file" id="fileInput" accept="audio/*" /></div>
      <div class="controls">
        <button id="playBtn">▶︎</button>
        <button id="pauseBtn">❚❚</button>
        <button id="stopBtn">⏹ Restart</button>
        <span class="time" id="timeDisplay">00:00.000</span>
      </div>
      <canvas id="waveform"></canvas>
      <div class="controls">
        <button id="addCueBtn">＋ Cue</button>
      </div>
      <div class="cue-list">
        <table>
          <thead>
            <tr><th>Time</th><th>Note</th><th>Actions</th></tr>
          </thead>
          <tbody id="cueTableBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <audio id="audioEl" crossorigin="anonymous" hidden></audio>

  <script>
    const playlistEl=document.getElementById('playlist');
    const newPageBtn=document.getElementById('newPageBtn');
    const audioEl=document.getElementById('audioEl');
    const playBtn=document.getElementById('playBtn');
    const pauseBtn=document.getElementById('pauseBtn');
    const stopBtn=document.getElementById('stopBtn');
    const timeDisplay=document.getElementById('timeDisplay');
    const waveform=document.getElementById('waveform');
    const cueTableBody=document.getElementById('cueTableBody');

    let pages=[];let currentPage=0;

    function addPage(name="Page", color="#333"){
      pages.push({name, color, cues: []});
      currentPage=pages.length-1;
      renderPages();
      loadPage();
    }

    newPageBtn.addEventListener('click',()=>addPage("Page "+(pages.length+1)));

    function renderPages(){
      playlistEl.innerHTML='';
      pages.forEach((p,i)=>{
        const btn=document.createElement('div');
        btn.className='page-btn';
        btn.style.background=p.color||'#333';

        const label=document.createElement('span');
        label.textContent=p.name;
        label.className='page-label';

        btn.addEventListener('click',()=>{currentPage=i;loadPage();});

        label.addEventListener('dblclick',(ev)=>{
          ev.stopPropagation();
          const input=document.createElement('input');
          input.value=p.name;
          input.className='rename-input';
          btn.innerHTML='';
          btn.appendChild(input);
          input.focus();
          input.select();
          input.addEventListener('blur',()=>{p.name=input.value||p.name;renderPages();});
          input.addEventListener('keydown',(ev)=>{if(ev.key==='Enter'){p.name=input.value||p.name;renderPages();}});
        });

        const rm=document.createElement('button');
        rm.textContent='✕';
        rm.className='remove-btn';
        rm.addEventListener('click',(ev)=>{
          ev.stopPropagation();
          if(confirm('Remove page "'+p.name+'"?')){
            pages.splice(i,1);
            if(currentPage>=pages.length)currentPage=Math.max(0,pages.length-1);
            renderPages();
            loadPage();
          }
        });

        btn.appendChild(label);
        btn.appendChild(rm);
        playlistEl.appendChild(btn);
      });
    }

    function loadPage(){
      console.log("Loaded page",pages[currentPage]?.name);
      cueTableBody.innerHTML='';
      if(!pages[currentPage])return;
      pages[currentPage].cues.forEach((cue,j)=>{
        const tr=document.createElement('tr');
        tr.innerHTML='<td>'+cue.time+'</td><td>'+cue.note+'</td><td><button data-i="'+j+'">Delete</button></td>';
        tr.querySelector('button').addEventListener('click',()=>{
          pages[currentPage].cues.splice(j,1);
          loadPage();
        });
        cueTableBody.appendChild(tr);
      });
    }

    // Basic audio controls
    playBtn.addEventListener('click',()=>audioEl.play());
    pauseBtn.addEventListener('click',()=>audioEl.pause());
    stopBtn.addEventListener('click',()=>{if(isFinite(audioEl.duration)){audioEl.currentTime=0;}audioEl.pause();});

    audioEl.addEventListener('timeupdate',()=>{
      const t=audioEl.currentTime;
      const ms=(t%1).toFixed(3).substring(2);
      const s=('0'+Math.floor(t%60)).slice(-2);
      const m=('0'+Math.floor(t/60)).slice(-2);
      timeDisplay.textContent=`${m}:${s}.${ms}`;
    });

    // Initialize
    addPage("Page 1");
  </script>
</body>
</html>
